<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>装饰器 | TypeScript 学习指南</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/learn-typescript/assets/css/0.styles.505541f7.css" as="style"><link rel="preload" href="/learn-typescript/assets/js/app.36aa69cc.js" as="script"><link rel="preload" href="/learn-typescript/assets/js/1.f9fc887e.js" as="script"><link rel="preload" href="/learn-typescript/assets/js/39.36e767b9.js" as="script"><link rel="prefetch" href="/learn-typescript/assets/js/10.48abe3b4.js"><link rel="prefetch" href="/learn-typescript/assets/js/11.ade88320.js"><link rel="prefetch" href="/learn-typescript/assets/js/12.017767e2.js"><link rel="prefetch" href="/learn-typescript/assets/js/13.ef765a8b.js"><link rel="prefetch" href="/learn-typescript/assets/js/14.0f2cdc03.js"><link rel="prefetch" href="/learn-typescript/assets/js/15.1d96fe45.js"><link rel="prefetch" href="/learn-typescript/assets/js/16.e3f9e054.js"><link rel="prefetch" href="/learn-typescript/assets/js/17.64ec25f1.js"><link rel="prefetch" href="/learn-typescript/assets/js/18.dcbec93d.js"><link rel="prefetch" href="/learn-typescript/assets/js/19.441e0e96.js"><link rel="prefetch" href="/learn-typescript/assets/js/20.938b4dd8.js"><link rel="prefetch" href="/learn-typescript/assets/js/21.110d242b.js"><link rel="prefetch" href="/learn-typescript/assets/js/22.18d1008e.js"><link rel="prefetch" href="/learn-typescript/assets/js/23.3960d78f.js"><link rel="prefetch" href="/learn-typescript/assets/js/24.d14aa350.js"><link rel="prefetch" href="/learn-typescript/assets/js/25.f8b5c35d.js"><link rel="prefetch" href="/learn-typescript/assets/js/26.7ee3bc6b.js"><link rel="prefetch" href="/learn-typescript/assets/js/27.e3ba220e.js"><link rel="prefetch" href="/learn-typescript/assets/js/28.4c2122ee.js"><link rel="prefetch" href="/learn-typescript/assets/js/29.fc8d980a.js"><link rel="prefetch" href="/learn-typescript/assets/js/3.15362abe.js"><link rel="prefetch" href="/learn-typescript/assets/js/30.e1f51b53.js"><link rel="prefetch" href="/learn-typescript/assets/js/31.6afb3102.js"><link rel="prefetch" href="/learn-typescript/assets/js/32.28eeae54.js"><link rel="prefetch" href="/learn-typescript/assets/js/33.ef164ebb.js"><link rel="prefetch" href="/learn-typescript/assets/js/34.65464d70.js"><link rel="prefetch" href="/learn-typescript/assets/js/35.4e14fe72.js"><link rel="prefetch" href="/learn-typescript/assets/js/36.201ceadd.js"><link rel="prefetch" href="/learn-typescript/assets/js/37.ffa1f8b4.js"><link rel="prefetch" href="/learn-typescript/assets/js/38.08b4917f.js"><link rel="prefetch" href="/learn-typescript/assets/js/4.cf09c44b.js"><link rel="prefetch" href="/learn-typescript/assets/js/40.47c09abb.js"><link rel="prefetch" href="/learn-typescript/assets/js/41.97f9f921.js"><link rel="prefetch" href="/learn-typescript/assets/js/42.eeaf2c59.js"><link rel="prefetch" href="/learn-typescript/assets/js/43.37c98c1a.js"><link rel="prefetch" href="/learn-typescript/assets/js/44.1982d757.js"><link rel="prefetch" href="/learn-typescript/assets/js/45.cd59f3b0.js"><link rel="prefetch" href="/learn-typescript/assets/js/46.42d3ab8d.js"><link rel="prefetch" href="/learn-typescript/assets/js/47.aa81af67.js"><link rel="prefetch" href="/learn-typescript/assets/js/48.53555094.js"><link rel="prefetch" href="/learn-typescript/assets/js/49.1882f172.js"><link rel="prefetch" href="/learn-typescript/assets/js/5.6113cfba.js"><link rel="prefetch" href="/learn-typescript/assets/js/50.faa1c480.js"><link rel="prefetch" href="/learn-typescript/assets/js/51.d580edc8.js"><link rel="prefetch" href="/learn-typescript/assets/js/52.ea68aacd.js"><link rel="prefetch" href="/learn-typescript/assets/js/53.d0e2df9d.js"><link rel="prefetch" href="/learn-typescript/assets/js/54.53ec2358.js"><link rel="prefetch" href="/learn-typescript/assets/js/55.543ac204.js"><link rel="prefetch" href="/learn-typescript/assets/js/56.4b196868.js"><link rel="prefetch" href="/learn-typescript/assets/js/57.41e02253.js"><link rel="prefetch" href="/learn-typescript/assets/js/6.4f2b5760.js"><link rel="prefetch" href="/learn-typescript/assets/js/7.1a8cf7d9.js"><link rel="prefetch" href="/learn-typescript/assets/js/8.fdaaa48a.js"><link rel="prefetch" href="/learn-typescript/assets/js/9.29608bb3.js">
    <link rel="stylesheet" href="/learn-typescript/assets/css/0.styles.505541f7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-typescript/" class="home-link router-link-active"><!----> <span class="site-name">TypeScript 学习指南</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/learn-typescript/" class="nav-link">
  教程
</a></div><div class="nav-item"><a href="/learn-typescript/cheatsheet/" class="nav-link">
  cheatsheet
</a></div><div class="nav-item"><a href="/learn-typescript/new-feature.html" class="nav-link">
  新特性
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/learn-typescript/" class="nav-link">
  教程
</a></div><div class="nav-item"><a href="/learn-typescript/cheatsheet/" class="nav-link">
  cheatsheet
</a></div><div class="nav-item"><a href="/learn-typescript/new-feature.html" class="nav-link">
  新特性
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/learn-typescript/" aria-current="page" class="sidebar-link">TypeScript 概述</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>类型系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-typescript/tutorial/1.basic-concept.html" class="sidebar-link">快速入门</a></li><li><a href="/learn-typescript/tutorial/2.1.primitive-types.html" class="sidebar-link">原始类型-JavaScript 原始类型</a></li><li><a href="/learn-typescript/tutorial/2.2.special-primitive-types.html" class="sidebar-link">原始类型-void never</a></li><li><a href="/learn-typescript/tutorial/2.3.literal-types.html" class="sidebar-link">原始类型-字面量类型</a></li><li><a href="/learn-typescript/tutorial/2.4.template-literal-type.html" class="sidebar-link">模板字面量(Template Literal Types)</a></li><li><a href="/learn-typescript/tutorial/2.5.enum.html" class="sidebar-link">原始类型-枚举类型</a></li><li><a href="/learn-typescript/tutorial/3.1.object-types.html" class="sidebar-link">对象类型</a></li><li><a href="/learn-typescript/tutorial/3.2.builtin-literal-object.html" class="sidebar-link">对象类型-内建对象和字面量对象</a></li><li><a href="/learn-typescript/tutorial/3.3.array.html" class="sidebar-link">对象类型-数组和元祖</a></li><li><a href="/learn-typescript/tutorial/3.4.function.html" class="sidebar-link">对象类型-函数</a></li><li><a href="/learn-typescript/tutorial/3.5.class.html" class="sidebar-link">对象类型-类</a></li><li><a href="/learn-typescript/tutorial/3.6.class-inheritance.html" class="sidebar-link">类的扩展</a></li><li><a href="/learn-typescript/tutorial/3.7.decorator.html" aria-current="page" class="active sidebar-link">装饰器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#装饰器概述" class="sidebar-link">装饰器概述</a></li><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#语法详解" class="sidebar-link">语法详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#类装饰器" class="sidebar-link">类装饰器</a></li><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#方法装饰器" class="sidebar-link">方法装饰器</a></li><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#静态方法" class="sidebar-link">静态方法</a></li><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#属性装饰器" class="sidebar-link">属性装饰器</a></li><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#静态属性装饰器" class="sidebar-link">静态属性装饰器</a></li><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#访问器属性装饰器" class="sidebar-link">访问器属性装饰器</a></li><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#参数装饰器" class="sidebar-link">参数装饰器</a></li><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#装饰器工厂" class="sidebar-link">装饰器工厂</a></li><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#装饰器组合" class="sidebar-link">装饰器组合</a></li></ul></li><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#注解-annotations-和装饰器-decorator" class="sidebar-link">注解(Annotations) 和装饰器 (decorator)</a></li><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#使用场景" class="sidebar-link">使用场景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#元编程" class="sidebar-link">元编程</a></li></ul></li><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/learn-typescript/tutorial/3.7.decorator.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/learn-typescript/tutorial/3.8.interface.html" class="sidebar-link">接口</a></li><li><a href="/learn-typescript/tutorial/3.9.this.html" class="sidebar-link">this</a></li><li><a href="/learn-typescript/tutorial/4.1.union-types.html" class="sidebar-link">联合类型</a></li><li><a href="/learn-typescript/tutorial/4.2.intersection-types.html" class="sidebar-link">交叉类型</a></li><li><a href="/learn-typescript/tutorial/5.generics.html" class="sidebar-link">泛型</a></li><li><a href="/learn-typescript/tutorial/6.1.module.html" class="sidebar-link">模块</a></li><li><a href="/learn-typescript/tutorial/6.2.module-resolution.html" class="sidebar-link">模块解析</a></li><li><a href="/learn-typescript/tutorial/7.namespace.html" class="sidebar-link">命名空间</a></li><li><a href="/learn-typescript/tutorial/8.1.declare.html" class="sidebar-link">申明文件概述</a></li><li><a href="/learn-typescript/tutorial/8.2.declare-ambients.html" class="sidebar-link">申明文件-ambients</a></li><li><a href="/learn-typescript/tutorial/8.3.declare-DefinitelyTyped.html" class="sidebar-link">申明文件-模块定义</a></li><li><a href="/learn-typescript/tutorial/9.config.html" class="sidebar-link">项目配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>类型编程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-typescript/type-program/" class="sidebar-link">类型编程</a></li><li><a href="/learn-typescript/type-program/1.1.index-type.html" class="sidebar-link">索引类型 (index type)</a></li><li><a href="/learn-typescript/type-program/1.2.mapped-type.html" class="sidebar-link">映射类型 (mapped type )</a></li><li><a href="/learn-typescript/type-program/2.conditional-type.html" class="sidebar-link">条件类型 (conditional type)</a></li><li><a href="/learn-typescript/type-program/3.utils-type.html" class="sidebar-link">工具类型</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>理解类型系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-typescript/_draft/type-system/type-assertion.html" class="sidebar-link">类型断言</a></li><li><a href="/learn-typescript/_draft/type-system/type-guards.html" class="sidebar-link">导航守卫</a></li><li><a href="/learn-typescript/_draft/type-system/type-inference.html" class="sidebar-link">类型推导</a></li><li><a href="/learn-typescript/_draft/type-system/type-scope.html" class="sidebar-link">类型的作用域</a></li><li><a href="/learn-typescript/_draft/type-system/type-program.html" class="sidebar-link">类型编程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-typescript/_draft/engineering/ffp.html" class="sidebar-link">函数式编程</a></li><li><a href="/learn-typescript/_draft/engineering/javascript.html" class="sidebar-link">javascript 文件类型检查</a></li><li><a href="/learn-typescript/_draft/engineering/jsx.html" class="sidebar-link">jsx</a></li><li><a href="/learn-typescript/_draft/engineering/vue.html" class="sidebar-link">vue</a></li><li><a href="/learn-typescript/_draft/engineering/performance.html" class="sidebar-link">性能</a></li><li><a href="/learn-typescript/_draft/engineering/validation.html" class="sidebar-link">运行时校验讲解</a></li><li><a href="/learn-typescript/_draft/engineering/test.html" class="sidebar-link">typescript 单元测试</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="装饰器"><a href="#装饰器" class="header-anchor">#</a> 装饰器</h1> <p>除了采用继承和混入对类进行扩展，装饰器语法提供了一种新的方式。使用装饰器前确保, <code>tsconfig.json</code> 中打开了 <code>experimentalDecorators</code> 配置。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 打开装饰器配置</span>
        <span class="token property">&quot;experimentalDecorators&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="装饰器概述"><a href="#装饰器概述" class="header-anchor">#</a> 装饰器概述</h2> <p>装饰器是处于 <a href="https://github.com/wycats/javascript-decorators" target="_blank" rel="noopener noreferrer">草案阶段 stage2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 ECMAScript 语法，Typescript 基于此草案实现了改特性。</p> <p>装饰器语法实现了对类的动态扩充，避免了直接对类的修改。是实现 <a href="https://en.wikipedia.org/wiki/Aspect-oriented_programming" target="_blank" rel="noopener noreferrer">面向切面编程 AOP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的一种手段。</p> <p>TypeScript 提供了一系列装饰器语法来实现对类的动态修改，<strong>TypeScript 和 js 草案在装饰器实现上有差异</strong> 罗列如下：</p> <table><thead><tr><th style="text-align:left;">装饰器</th> <th style="text-align:left;">功能</th> <th style="text-align:left;">ts</th> <th style="text-align:left;">js 草案</th></tr></thead> <tbody><tr><td style="text-align:left;">类装饰器</td> <td style="text-align:left;">扩充类</td> <td style="text-align:left;">✅</td> <td style="text-align:left;">✅</td></tr> <tr><td style="text-align:left;">类方法装饰器</td> <td style="text-align:left;">修改类的方法</td> <td style="text-align:left;">✅</td> <td style="text-align:left;">✅</td></tr> <tr><td style="text-align:left;">类静态方法装饰器</td> <td style="text-align:left;">修改类的静态方法</td> <td style="text-align:left;">✅</td> <td style="text-align:left;">✅</td></tr> <tr><td style="text-align:left;">类属性装饰器</td> <td style="text-align:left;">修改类的属性</td> <td style="text-align:left;">✅</td> <td style="text-align:left;">✅</td></tr> <tr><td style="text-align:left;">类静态属性装饰器</td> <td style="text-align:left;">修改类的静态属性</td> <td style="text-align:left;">✅</td> <td style="text-align:left;">✅</td></tr> <tr><td style="text-align:left;">类访问器属性装饰器</td> <td style="text-align:left;">修改类的访问器属性</td> <td style="text-align:left;">✅</td> <td style="text-align:left;">✅</td></tr> <tr><td style="text-align:left;">类参数装饰器</td> <td style="text-align:left;">修改类方法的参数</td> <td style="text-align:left;">✅</td> <td style="text-align:left;">⬜</td></tr> <tr><td style="text-align:left;">装饰器工厂</td> <td style="text-align:left;">动态设置装饰器</td> <td style="text-align:left;">✅</td> <td style="text-align:left;">✅</td></tr> <tr><td style="text-align:left;">装饰器组合</td> <td style="text-align:left;">混合多个装饰器</td> <td style="text-align:left;">✅</td> <td style="text-align:left;">✅</td></tr></tbody></table> <p>为什么没有函数的装饰器，详细讨论参见 <a href="https://github.com/NoBey/nobey/issues/44" target="_blank" rel="noopener noreferrer">decorators for functions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 目前原因为函数提升导致了函数装饰器的不易实现，github 存在如下的 <a href="https://github.com/finom/function-decorators-proposal" target="_blank" rel="noopener noreferrer">function-decorators-proposal<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 解决此问题</p> <h2 id="语法详解"><a href="#语法详解" class="header-anchor">#</a> 语法详解</h2> <h3 id="类装饰器"><a href="#类装饰器" class="header-anchor">#</a> 类装饰器</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// TODO: 此处扩展示例需修改</span>
<span class="token comment">// 1. 定义类装饰器函数，传入为类构造器</span>
<span class="token keyword">function</span> <span class="token function">testAble</span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  target<span class="token punctuation">.</span>_test <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/** 
 * 2. 在类之前采用 @&lt;函数名&gt; 生命类装饰器
 * 改代码会在代码运行时执行如下逻辑
 * class Class1 {};
 * testAble(Class1); // 动态增加属性
 * */</span> 

@testAble
<span class="token keyword">class</span> <span class="token class-name">Class1</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Class1<span class="token punctuation">)</span></code></pre></div><p>也可以返回一个新的类</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// TODO: 此处扩展示例需修改</span>
<span class="token comment">// 1. 定义装饰器返回新的构造器</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">classDecorator</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">{</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  <span class="token keyword">constructor</span><span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token keyword">extends</span></span> <span class="token keyword">constructor</span> <span class="token punctuation">{</span>
    newProperty <span class="token operator">=</span> <span class="token string">&quot;new property&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


@classDecorator
<span class="token keyword">class</span> <span class="token class-name">Class2</span> <span class="token punctuation">{</span>
  a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Class2<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Class2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div><h3 id="方法装饰器"><a href="#方法装饰器" class="header-anchor">#</a> 方法装饰器</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// TODO: 此处扩展示例需修改</span>
<span class="token comment">// 1. 定义类装饰器函数，传入为类构造器</span>
<span class="token keyword">function</span> <span class="token function">dicription</span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> key<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">decrption method </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">Class3</span> <span class="token punctuation">{</span>
  @dicription
  <span class="token comment">/** 
   * 2. 在方法之前采用 @&lt;函数名&gt; 设置装饰器
   * 改代码会在运行时，效果如下
   * class Class3 { method1() { // ... } };
   * dicription(Class3.prototype,'method1',Object.getOwnPropertyDescriptor('method1') )
   * */</span> 
  <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'method1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Class3<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Class3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div><p>若想在函数运行时也执行装饰器的注入逻辑，可修改方法描述对象的 value 值</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// TODO: 此处扩展示例需修改</span>
<span class="token comment">// 1. 定义类装饰器函数，传入为类构造器</span>
<span class="token keyword">function</span> <span class="token function">dicription1</span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> key<span class="token operator">:</span> PropertyKey <span class="token punctuation">,</span> val<span class="token operator">:</span> PropertyDescriptor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run in init'</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> method <span class="token punctuation">}</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> Class4<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run in method call'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">decrption method </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注意此处采用 call 防止 this 丢失</span>
    <span class="token function">method</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>arguments<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 修改原始函数</span>
  val<span class="token punctuation">.</span>value <span class="token operator">=</span> change
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'change method success'</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">Class4</span> <span class="token punctuation">{</span>
  <span class="token comment">/** 
   * 2. 在方法之前采用 @&lt;函数名&gt; 设置装饰器
   * 改代码会在运行时，效果如下
   * class Class3 { method1() { // ... } };
   * dicription(Class3.prototype,'method1',Object.getOwnPropertyDescriptor('method1') )
   * */</span> 
  @dicription1
  <span class="token function">method1</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'method1'</span><span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>method1<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Class4<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Class4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意示例中高亮行，修改方法运行时需避免 this 的丢失</p></div> <p>也可直接返回修改的方法描述对象</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// TODO: 此处扩展示例需修改</span>
<span class="token comment">// 1. 定义类装饰器函数，传入为类构造器</span>
<span class="token keyword">function</span> <span class="token function">dicription</span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> key<span class="token operator">:</span> PropertyKey <span class="token punctuation">,</span> val<span class="token operator">:</span> PropertyDescriptor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run in method call'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">decrption method </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 注意此处采用 call 防止 this 丢失</span>
      <span class="token keyword">return</span> val<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>arguments<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">ClassTest</span> <span class="token punctuation">{</span>
  <span class="token comment">/** 
   * 2. 在方法之前采用 @&lt;函数名&gt; 设置装饰器
   * 改代码会在运行时，效果如下
   * class Class3 { method1() { // ... } };
   * dicription(Class3.prototype,'method1',Object.getOwnPropertyDescriptor('method1') )
   * */</span> 
  @dicription
  <span class="token function">method1</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'method1'</span><span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>method1<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ClassTest<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div><h3 id="静态方法"><a href="#静态方法" class="header-anchor">#</a> 静态方法</h3> <p>除了类方法，装饰器也支持对静态方法的修改</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// TODO: 此处扩展示例需修改</span>
<span class="token comment">// 1. 定义类装饰器函数，传入为类构造器</span>
<span class="token keyword">function</span> <span class="token function">dicription2</span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> key<span class="token operator">:</span> String<span class="token punctuation">,</span> val<span class="token operator">:</span> PropertyDescriptor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">decrption method </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">Class5</span> <span class="token punctuation">{</span>
  <span class="token comment">/** 
   * 2. 在方法之前采用 @&lt;函数名&gt; 设置装饰器
   * 改代码会在运行时，效果如下
   * class Class5 { method1() { // ... } };
   * dicription(Class5,'method1',Object.getOwnPropertyDescriptor('method1') )
   * */</span> 
  @dicription2
  <span class="token keyword">static</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'method1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Class5<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Class5<span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意静态方法装饰器的 target 为类，而非类的原型，一个简单的记忆原则是，
target 为修改内容的所属者，例如方法属于类的原型所以 target 为类，静态方式属于类
所以 target 为类，该规则适用于所有装饰器</p></div> <p>也可采用修改属性描述符，实现在调用时触发相关逻辑</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// TODO: 此处扩展示例需修改</span>
<span class="token comment">// 1. 定义类装饰器函数，传入为类构造器</span>
<span class="token keyword">function</span> <span class="token function">dicription3</span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> key<span class="token operator">:</span> PropertyKey <span class="token punctuation">,</span> val<span class="token operator">:</span> PropertyDescriptor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run in init'</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> method <span class="token punctuation">}</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run in method call'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">decrption method </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注意此处采用 call 防止 this 丢失</span>
    <span class="token function">method</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>arguments<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 修改原始函数</span>
  val<span class="token punctuation">.</span>value <span class="token operator">=</span> change
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'change method success'</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">Class6</span> <span class="token punctuation">{</span>
  @dicription3
  <span class="token keyword">static</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'method1'</span><span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>method1<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Class6<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Class6<span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div><h3 id="属性装饰器"><a href="#属性装饰器" class="header-anchor">#</a> 属性装饰器</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">/**
 * 注意由于属性值在实例化时才存在，所以无 value 参数
 * @param target 类的原型，由于实例在初始化时才创建，此处用原型替代
 * @param key 属性值
 */</span>
<span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span>target<span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">,</span> key<span class="token operator">:</span> PropertyKey<span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">any</span> <span class="token punctuation">{</span>
    <span class="token comment">// 修改属性为只读</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run in init'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> val<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        val <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Set </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> val<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Class8</span>  <span class="token punctuation">{</span>
    @log
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span>name <span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class8</span> <span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;%o&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span></code></pre></div><p>由于属性在实例化时才创建，而装饰器在类声明时就运行，如何实现在创建类时才执行描述符定义。
这里利用了 <code>Reflect.decorate</code> 方法。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意定义属性装饰器时不要传入 value 参数， ts 检查会报错，
详见 <a href="https://github.com/microsoft/TypeScript/issues/19528" target="_blank" rel="noopener noreferrer">Why I can't use decorator on property<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h3 id="静态属性装饰器"><a href="#静态属性装饰器" class="header-anchor">#</a> 静态属性装饰器</h3> <p>静态属性也可使用装饰器</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span>target<span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">,</span> key<span class="token operator">:</span> PropertyKey<span class="token punctuation">,</span> descriptor<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run init'</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
  <span class="token keyword">let</span> oldGetter <span class="token operator">=</span> descriptor<span class="token punctuation">.</span><span class="token keyword">get</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'log'</span><span class="token punctuation">,</span> descriptor<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token comment">// 报错原因</span>
      <span class="token function">oldGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Class10</span>  <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token function">fullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">string</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastName
    <span class="token punctuation">}</span>
    firstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    lastName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token keyword">constructor</span> <span class="token punctuation">(</span>firstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> lastName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> firstName<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> lastName<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对只读属性重写报错</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class10</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>fullName 
</code></pre></div><h3 id="访问器属性装饰器"><a href="#访问器属性装饰器" class="header-anchor">#</a> 访问器属性装饰器</h3> <p>也可设置访问器属性为装饰器。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token keyword">readonly</span><span class="token punctuation">(</span>target<span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">,</span> key<span class="token operator">:</span> PropertyKey<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run init'</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    writable<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Class9</span>  <span class="token punctuation">{</span>
    @<span class="token keyword">readonly</span>
    <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对只读属性重写报错</span>
Class9<span class="token punctuation">.</span>username <span class="token operator">=</span> <span class="token string">'jack'</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Class9<span class="token punctuation">.</span>username<span class="token punctuation">)</span></code></pre></div><h3 id="参数装饰器"><a href="#参数装饰器" class="header-anchor">#</a> 参数装饰器</h3> <p>参数装饰器,注意参数装饰器传入的第三个参数为 <code>index</code>， 参数对应索引值。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 1. 定义参数装饰器</span>
<span class="token keyword">function</span> <span class="token function">requireVal</span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>key<span class="token operator">:</span> PropertyKey<span class="token punctuation">,</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">any</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> d <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">)</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'init run'</span><span class="token punctuation">,</span> arguments<span class="token punctuation">,</span> target<span class="token punctuation">,</span> d<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>arguments<span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'must have name'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> d<span class="token operator">?.</span><span class="token function">value</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>arguments<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Greeter2</span> <span class="token punctuation">{</span>
  <span class="token function">greet</span><span class="token punctuation">(</span>@requireVal name<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Hello &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 运行时会检查属性值， TODO: tsnode 为什么失败</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Greeter2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Greeter2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div><h3 id="装饰器工厂"><a href="#装饰器工厂" class="header-anchor">#</a> 装饰器工厂</h3> <p>利用装饰工厂动态创建装饰器，返回的装饰器会在类申明时运行。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 1. 申明装饰器工厂返回装饰器函数</span>
<span class="token keyword">function</span> <span class="token function">testAble</span><span class="token punctuation">(</span>flag<span class="token operator">:</span> Boolean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">.</span>_test <span class="token operator">=</span> flag
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 返回类构造器，类申明时，设置类的 _test 为 false</span>
@<span class="token function">testAble</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Class11</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Class11<span class="token punctuation">)</span>

<span class="token comment">// 返回类构造器，类申明时，设置类的 _test 为 true</span>
@<span class="token function">testAble</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Class12</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Class12<span class="token punctuation">)</span>
</code></pre></div><h3 id="装饰器组合"><a href="#装饰器组合" class="header-anchor">#</a> 装饰器组合</h3> <p>装饰器可以叠加使用。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">d1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">any</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;d1(): evaluated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
    target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> PropertyKey<span class="token punctuation">,</span>
    val<span class="token operator">:</span> PropertyDecorator
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;d1(): called&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">d2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">any</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;d2(): evaluated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
    target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
    key<span class="token operator">:</span> PropertyKey<span class="token punctuation">,</span>
    val<span class="token operator">:</span> PropertyDecorator
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;d2(): called&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * tsc 编译后的执行结果类似
 * let d1Res = d1()
 * let d2Res = d1()
 * // 靠近方法的装饰器先执行
 * d2Res(target,key,value)
 * d1Res(target,key,value)
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Class14</span> <span class="token punctuation">{</span>
  @<span class="token function">d1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  @<span class="token function">d2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// return </span>
<span class="token comment">// d1(): evaluated</span>
<span class="token comment">// d2(): evaluated</span>
<span class="token comment">// d2(): called</span>
<span class="token comment">// d1(): called</span></code></pre></div><p>注意组合装饰器是的执行顺序是从内往外。</p> <h2 id="注解-annotations-和装饰器-decorator"><a href="#注解-annotations-和装饰器-decorator" class="header-anchor">#</a> 注解(Annotations) 和装饰器 (decorator)</h2> <p>参考 <a href="https://blog.thoughtram.io/angular/2015/05/03/the-difference-between-annotations-and-decorators.html" target="_blank" rel="noopener noreferrer">The difference between Annotations and Decorators<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
注解为类提供额外的注释信息，可以采用装饰器语法实现该功能。</p> <h2 id="使用场景"><a href="#使用场景" class="header-anchor">#</a> 使用场景</h2> <h3 id="元编程"><a href="#元编程" class="header-anchor">#</a> 元编程</h3> <p>typescript 内置了一些装饰器通过 <code>emitDecoratorMetadata</code> 配置打开。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;emitDecoratorMetadata&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>该配置会内置 <a href="https://github.com/rbuckton/reflect-metadata" target="_blank" rel="noopener noreferrer">reflect-metadata<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 相关装饰器</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ol><li>装饰器是一个函数，用于实现对类的动态修改，基本结构如下<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">decorator</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key <span class="token punctuation">,</span>value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 可以返回新的类或属性描述对象</span>
<span class="token punctuation">}</span>

</code></pre></div></li> <li>类的装饰器入参为类，支持返回新的类替换原有类</li> <li>方法装饰器，入参为 <code>类的原型，方法名，方法描述符</code>，通过修改方法描述符实现运行时修改，支持返回新的属性描述符进行替换</li> <li>静态方法装饰器，入参的第一个参数为类，其他功能和方法装饰器类似</li> <li>属性装饰器,入参为 <code>类的原型，属性名</code></li> <li>静态属性装饰器,入参为 <code>类的原型，属性名</code></li> <li>访问器属性装饰器,入参为 <code>类的原型，属性名</code></li> <li>装饰器工厂，返回装饰器用于实现动态设置装饰器</li> <li>多重装饰器，装饰器的叠加使用</li> <li>使用场景</li> <li>类装饰器，动态扩充方法，混入</li> <li>属性装饰器，
<ol><li>格式化属性值</li> <li>校验属性值</li></ol></li> <li>方法装饰器
<ol><li>废弃方法申明</li> <li>方法只读</li></ol></li> <li>额外注意事项
<ol><li>装饰器的运行时机是在类申明后，可以通过修改属性描述符实现方法运行时的动态插入</li></ol></li></ol> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://github.com/wycats/javascript-decorators" target="_blank" rel="noopener noreferrer">装饰器提案<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.typescriptlang.org/docs/handbook/decorators.html" target="_blank" rel="noopener noreferrer">装饰器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/learn-typescript/tutorial/3.6.class-inheritance.html" class="prev">
        类的扩展
      </a></span> <span class="next"><a href="/learn-typescript/tutorial/3.8.interface.html">
        接口
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/learn-typescript/assets/js/app.36aa69cc.js" defer></script><script src="/learn-typescript/assets/js/1.f9fc887e.js" defer></script><script src="/learn-typescript/assets/js/39.36e767b9.js" defer></script>
  </body>
</html>
