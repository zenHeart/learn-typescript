(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{406:function(t,s,a){"use strict";a.r(s);var e=a(42),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块"}},[t._v("#")]),t._v(" 模块")]),t._v(" "),a("p",[t._v("本章讲解 TypeScript 中的模块。开始之前阅读\n"),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN  模块"),a("OutboundLink")],1),t._v(" 了解 ES6 等模块系统的基本概念。这里重点介绍 TypeScript 的扩充")]),t._v(" "),a("h2",{attrs:{id:"类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#类型"}},[t._v("#")]),t._v(" 类型")]),t._v(" "),a("p",[t._v("在 ES6 中使用 "),a("code",[t._v("export")])]),t._v(" "),a("h2",{attrs:{id:"export"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#export"}},[t._v("#")]),t._v(" export")]),t._v(" "),a("p",[t._v("类似 es6 module 规范，类型申明的作用范围为当前文件。\n为了复用类型申明，可采用 "),a("code",[t._v("export,import")]),t._v(" 等语法来导出申明。")]),t._v(" "),a("p",[t._v("你可以复用所有 es6 module 的语法，用于申明类型的导出和引用")]),t._v(" "),a("p",[t._v("注意由于类型申明会和实际模块申明同时存在，所以需要避免命名冲突。")]),t._v(" "),a("h3",{attrs:{id:"导入省略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入省略"}},[t._v("#")]),t._v(" 导入省略")]),t._v(" "),a("p",[t._v("TypeScript 复用了 es6 模块语法实现类型导出。若 import 导入的只是类型申明， typescript 会在编译后忽略该导入。这导致对于同时是类型或变量的内容会出错。示例 "),a("a",{attrs:{href:"./type-import-elision/b.ts"}},[t._v("导入缺省")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件 a.ts")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Foo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("greet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'greet'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一些全局操作，此处以 console.log 举例")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'global init'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件 b.ts")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 由于 typescript 认为此处指类型导入，在编译后会忽略，使得 a.js 中的相关操作无法执行")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Foo "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./a'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 为了避免删除的导入缺省，重新导入此文件执行初始化操作")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./a'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("由于 TypeScript 识别 "),a("code",[t._v("Foo")]),t._v(" 为类型导出，导致 import 被忽略，使 "),a("code",[t._v("a.ts")]),t._v(" 无法触发，所以需要导入两次。该缺陷叫做 "),a("strong",[t._v("导入省略")])]),t._v(" "),a("blockquote",[a("p",[t._v("笔者注: TypeScript 复用 es 模块的语法来实现类型的导入和导出，这产生了二义性(一个语言特性同时具备两种功能)，导致引入了新的问题")])]),t._v(" "),a("p",[t._v("基于此在 "),a("a",{attrs:{href:"https://devblogs.microsoft.com/typescript/announcing-typescript-3-8-beta/#type-only-imports-exports",target:"_blank",rel:"noopener noreferrer"}},[t._v("TypeScript 3.8 Beta"),a("OutboundLink")],1),t._v(" 引入了 "),a("code",[t._v("import type")]),t._v(" 来显示申明类型导出， 避免了此错误")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.typescriptlang.org/v2/docs/handbook/release-notes/overview.html#import-types",target:"_blank",rel:"noopener noreferrer"}},[t._v("import types"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"export-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#export-2"}},[t._v("#")]),t._v(" export =")]),t._v(" "),a("p",[t._v("在 ES 模块系统中并没有此语言特性，该特性来源 Commonjs 和 AMD 。你可以通过 "),a("code",[t._v("module.exports")]),t._v(" 导出整个模块。基于此 TypeScript 提供了类似机制，示例 "),a("a",{attrs:{href:"./type-export-all/b.ts"}},[t._v("exprot =")])]),t._v(" "),a("blockquote",[a("p",[t._v("由于采用此导出，导入必须使用 "),a("code",[t._v("require")]),t._v(" 才可生效")])]),t._v(" "),a("h2",{attrs:{id:"模块申明-d-ts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块申明-d-ts"}},[t._v("#")]),t._v(" 模块申明 *.d.ts")]),t._v(" "),a("p",[t._v("由于类型的作用于只限定在当前文件，为了实现全局类型的复用。\nTypeScript 借鉴了 "),a("code",[t._v("C,C++")]),t._v(" 语言中的头文件模式，通过定义 "),a("code",[t._v("*.d.ts")]),t._v(" 的文件。TypeScript 会默认查找此文件该文件中的内容会在全局有效。")]),t._v(" "),a("h3",{attrs:{id:"shorthand-ambient-module-declarations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shorthand-ambient-module-declarations"}},[t._v("#")]),t._v(" [Shorthand ambient module declarations")]),t._v(" "),a("p",[t._v("](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-0.html#shorthand-ambient-module-declarations) 快捷环境模块申明\n采用")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对于没有类型定义的模块使用类似定义避免应用模块报错")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("declare")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ModuleName"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("此时使用模块中内容不会报错")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" y "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hot-new-module"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("x")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"wildcard-character-in-module-names-模式处理特定模式的模块导入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wildcard-character-in-module-names-模式处理特定模式的模块导入"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-0.html#wildcard-character-in-module-names",target:"_blank",rel:"noopener noreferrer"}},[t._v("Wildcard character in module names"),a("OutboundLink")],1),t._v(" 模式处理特定模式的模块导入")]),t._v(" "),a("ul",[a("li",[a("strong",[a("code",[t._v("*")])]),t._v(" 匹配任意多字符")])]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("declare")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*!text"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Some do it the other way around.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("declare")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json!*"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("此时支持导入")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" fileContent "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./xyz.txt!text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json!http://example.com/data.json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fileContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("采用 "),a("code",[t._v('declare module "myLibrary/*"')]),t._v(" 声明特定子路径所有模块")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" readFile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(' "myLibrary'),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("fileSystem"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("readFile`"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// readFile is 'any'")]),t._v("\n")])])]),a("h2",{attrs:{id:"export-type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#export-type"}},[t._v("#")]),t._v(" export type")]),t._v(" "),a("p",[t._v("详见 "),a("a",{attrs:{href:"https://www.typescriptlang.org/docs/handbook/release-notes/overview.html#type-only-imports-and-export",target:"_blank",rel:"noopener noreferrer"}},[t._v("export type"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"知识点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#知识点"}},[t._v("#")]),t._v(" 知识点")])])}),[],!1,null,null,null);s.default=n.exports}}]);